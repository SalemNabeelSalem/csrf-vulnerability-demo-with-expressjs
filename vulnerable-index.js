/**
 * Vulnerable to CSRF AttackðŸ˜…
 */
const express = require("express");
const cookieParser = require("cookie-parser");

app = express();

app.use(express.urlencoded({ extended: false }));
app.use(cookieParser());

app.listen(3000);

app.get("/", (req, res) => {
  // console.log(req.cookies);

  /**
   * imagine this next line where we set the cookie instead only happened if you had just provided a
   * correct username and password etc...
   */
  res.cookie("simpletest", "qwerty", { httpOnly: true });

  res.send(`
    <form action="/transfer-money" method="POST">
      <input type="text" name="amount" placeholder="Amount">
      <input type="text" name="to" placeholder="Send To">
      <button>Submit</button>
    </form>
  `);
});

app.post("/transfer-money", (req, res) => {
  // console.log(req.cookies);

  if (req.cookies.simpletest === "qwerty") {
    res.send("Success!");
  } else {
    res.send("Failed!");
  }
});
